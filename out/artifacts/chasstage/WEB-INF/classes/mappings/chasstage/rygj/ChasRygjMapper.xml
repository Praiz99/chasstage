<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wckj.chasstage.modules.rygj.dao.ChasRygjMapper">
  <resultMap id="BaseResultMap" type="com.wckj.chasstage.modules.rygj.entity.ChasRygj">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="ISDEL" jdbcType="INTEGER" property="isdel" />
    <result column="DATA_FLAG" jdbcType="CHAR" property="dataflag" />
    <result column="LRR_SFZH" jdbcType="VARCHAR" property="lrrSfzh" />
    <result column="LRSJ" jdbcType="TIMESTAMP" property="lrsj" />
    <result column="XGR_SFZH" jdbcType="VARCHAR" property="xgrSfzh" />
    <result column="XGSJ" jdbcType="TIMESTAMP" property="xgsj" />
    <result column="BAQID" jdbcType="VARCHAR" property="baqid" />
    <result column="BAQMC" jdbcType="VARCHAR" property="baqmc" />
    <result column="RYID" jdbcType="VARCHAR" property="ryid" />
    <result column="WDBH" jdbcType="VARCHAR" property="wdbh" />
    <result column="QYID" jdbcType="VARCHAR" property="qyid" />
    <result column="XM" jdbcType="VARCHAR" property="xm" />
    <result column="KSSJ" jdbcType="TIMESTAMP" property="kssj" />
    <result column="JSSJ" jdbcType="TIMESTAMP" property="jssj" />
    <result column="FZRXM" jdbcType="VARCHAR" property="fzrxm" />
    <result column="HDNR" jdbcType="VARCHAR" property="hdnr" />
    <result column="SBID" jdbcType="VARCHAR" property="sbid" />
    <result column="QYMC" jdbcType="VARCHAR" property="qymc" />
    <result column="RYBH" jdbcType="VARCHAR" property="rybh" />
    <result column="BZ" jdbcType="VARCHAR" property="bz"/>
    <result column="rylx" jdbcType="VARCHAR" property="rylx"/>
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    update chas_yw_rygj
    set isdel = 1,XGSJ = date_trunc('second', now())
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByRbyh" parameterType="java.lang.String">
    delete from chas_yw_rygj where RYBH = #{rybh,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.wckj.chasstage.modules.rygj.entity.ChasRygj">
    insert into chas_yw_rygj (ID, ISDEL, DATA_FLAG,
      LRR_SFZH, LRSJ, XGR_SFZH,
      XGSJ, BAQID, BAQMC,
      RYID, WDBH, QYID, XM,
      KSSJ, JSSJ, FZRXM,
      HDNR, SBID, QYMC, RYBH,BZ,rylx
      )
    values (#{id,jdbcType=VARCHAR}, #{isdel,jdbcType=INTEGER}, #{dataflag,jdbcType=CHAR},
      #{lrrSfzh,jdbcType=VARCHAR}, now(), #{xgrSfzh,jdbcType=VARCHAR},
      #{xgsj,jdbcType=TIMESTAMP}, #{baqid,jdbcType=VARCHAR}, #{baqmc,jdbcType=VARCHAR},
      #{ryid,jdbcType=VARCHAR}, #{wdbh,jdbcType=VARCHAR}, #{qyid,jdbcType=VARCHAR}, #{xm,jdbcType=VARCHAR},
      #{kssj,jdbcType=TIMESTAMP}, #{jssj,jdbcType=TIMESTAMP}, #{fzrxm,jdbcType=VARCHAR},
      #{hdnr,jdbcType=VARCHAR}, #{sbid,jdbcType=VARCHAR}, #{qymc,jdbcType=VARCHAR}, #{rybh,jdbcType=VARCHAR}
      ,#{bz,jdbcType=VARCHAR},#{rylx,jdbcType=VARCHAR}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.wckj.chasstage.modules.rygj.entity.ChasRygj">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 24 18:30:56 CST 2017.
    -->
    update chas_yw_rygj
    set ISDEL = #{isdel,jdbcType=INTEGER},
      DATA_FLAG = #{dataflag,jdbcType=CHAR},
      LRR_SFZH = #{lrrSfzh,jdbcType=VARCHAR},
      LRSJ = #{lrsj,jdbcType=TIMESTAMP},
      XGR_SFZH = #{xgrSfzh,jdbcType=VARCHAR},
      XGSJ = date_trunc('second', now()),
      BAQID = #{baqid,jdbcType=VARCHAR},
      BAQMC = #{baqmc,jdbcType=VARCHAR},
      RYID = #{ryid,jdbcType=VARCHAR},
      WDBH = #{wdbh,jdbcType=VARCHAR},
      QYID = #{qyid,jdbcType=VARCHAR},
      XM = #{xm,jdbcType=VARCHAR},
      KSSJ = #{kssj,jdbcType=TIMESTAMP},
      JSSJ = #{jssj,jdbcType=TIMESTAMP},
      FZRXM = #{fzrxm,jdbcType=VARCHAR},
      HDNR = #{hdnr,jdbcType=VARCHAR},
      SBID = #{sbid,jdbcType=VARCHAR},
      QYMC = #{qymc,jdbcType=VARCHAR},
      RYBH = #{rybh,jdbcType=VARCHAR},
      BZ = #{bz,jdbcType=VARCHAR},
      rylx = #{rylx,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
    WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, RYBH, BZ,rylx
    from chas_yw_rygj
    where isdel = 0 and ID = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
    WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, RYBH, BZ,rylx
      from chas_yw_rygj
     <where>
      1=1 and isdel = 0
      <if test="baqid != null and baqid !=''">
          and BAQID = '${baqid}'
      </if>
      <if test="wdbh != null and wdbh !=''">
          and WDBH = '${wdbh}'
      </if>
      <if test="qymc != null and qymc !=''">
          and QYMC = '${qymc}'
      </if>
      <if test="xgrSfzh != null and xgrSfzh !=''">
          and XGRSFZH = '${xgrSfzh}'
      </if>
      <if test="xm != null and xm !=''">
          and XM = '${xm}'
      </if>
      <if test="qymc != null and qymc !=''">
          and QYMC = '${qymc}'
      </if>
      <if test="qyid != null and qyid !=''">
          and QYID = '${qyid}'
      </if>
      <if test="kssj != null and kssj !=''">
          and KSSJ = '${kssj}'
      </if>
      <if test="rylx != null and rylx !=''">
          and rylx = '${rylx}'
      </if>
      <if test="jssj != null and jssj !=''">
          and JSSJ = '${jssj}'
      </if>
      <if test="ryid != null and ryid !=''">
          and RYID = '${ryid}'
      </if>
      <if test="rybh != null and rybh !=''">
          and RYBH = '${rybh}'
      </if>
     <if test="lrsjStart != '' and lrsjEnd != '' and lrsjStart != null and lrsjEnd != null">
         and lrsj >= to_timestamp('${lrsjStart}','yyyy-MM-dd hh24:mi:ss') and lrsj &lt;= to_timestamp('${lrsjEnd}','yyyy-MM-dd hh24:mi:ss')
     </if>
     <if test="kssjStart != '' and kssjStart != null">
         and kssj >= to_timestamp('${kssjStart}','yyyy-MM-dd hh24:mi:ss')
     </if>
     <if test="jssjEnd != '' and jssjEnd != null">
         and jssj &lt;= to_timestamp('${jssjEnd}','yyyy-MM-dd hh24:mi:ss')
     </if>
     <if test="gjsp != '' and gjsp != null">
         and kssj is not null and jssj is not null
     </if>
     <if test="temporary != '' and temporary != null">
         and EXTRACT(epoch FROM (jssj - kssj)) > ${temporary}
     </if>
     <!--<if test="qxbs == 'province'">-->
         <!--and DWXTBH LIKE CONCAT(left(#{orgSysCode,jdbcType=VARCHAR},2),'%')-->
     <!--</if>-->
     <!--<if test="qxbs == 'city'">-->
         <!--and DWXTBH LIKE CONCAT(left(#{orgSysCode,jdbcType=VARCHAR},4),'%')-->
     <!--</if>-->
     <!--<if test="qxbs == 'reg'">-->
         <!--and DWXTBH LIKE CONCAT(left(#{orgSysCode,jdbcType=VARCHAR},6),'%')-->
     <!--</if>-->
     <!--<if test="qxbs == 'org'">-->
         <!--and DWXTBH LIKE CONCAT(left(#{orgSysCode,jdbcType=VARCHAR},8),'%')-->
     <!--</if>-->
     <!--<if test="qxbs == 'user'">-->
         <!--and LRR_SFZH = #{idCard,jdbcType=VARCHAR}-->
     <!--</if>-->
    </where>
  </select>

  <select id="findbyparams" resultMap="BaseResultMap">
    select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
    WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, RYBH,BZ,rylx
      from chas_yw_rygj
     <where>
      jssj is null and isdel = 0
      <if test="baqid != null and baqid !=''">
          and BAQID = '${baqid}'
      </if>
      <if test="wdbh != null and wdbh !=''">
          and WDBH = '${wdbh}'
      </if>
      <if test="rybh != null and rybh !=''">
          and RYBH = '${rybh}'
      </if>
    </where>
  </select>

    <select id="findzhlocation" resultMap="BaseResultMap">
    select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
    WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, RYBH, BZ,rylx
        from chas_yw_rygj
     <where>
     	isdel = 0
      <if test="baqid != null and baqid !=''">
          and BAQID = '${baqid}'
      </if>
      <if test="wdbh != null and wdbh !=''">
          and WDBH = '${wdbh}'
      </if>
      <if test="rybh != null and rybh !=''">
          and RYBH = '${rybh}'
      </if>
      ORDER BY lrsj DESC limit 1 offset 0
    </where>
  </select>

    <select id="findzhlocations" resultMap="BaseResultMap">
        select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
        WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, RYBH, BZ,rylx
        from chas_yw_rygj
        <where>
            isdel = 0
            <if test="baqid != null and baqid !=''">
                and BAQID = '${baqid}'
            </if>
            <if test="wdbh != null and wdbh !=''">
                and WDBH = '${wdbh}'
            </if>
            <if test="rybh != null and rybh !=''">
                and RYBH = '${rybh}'
            </if>
            ORDER BY lrsj DESC
        </where>
    </select>

    <select id="selectAllByFk" resultType="java.util.HashMap">
        select gj.baqmc,fk.wdbh_l,fk.ryxm,gj.qymc,fk.rqsj,fk.cqsj,fk.lrr_sfzh
        from chas_yw_fkdj fk join chas_yw_rygj gj
        on fk.rybh = gj.rybh
        where 1 = 1 and fk.isdel = 0 and gj.isdel = 0
        <if test="rybh != null and rybh != ''">
            and gj.rybh = '${rybh}'
        </if>
        <if test="ryxm != null and ryxm != ''">
            and gj.xm = '${ryxm}'
        </if>
        <if test="wdbh != null and wdbh != ''">
            and (fk.wdbh_l = '${wdbh}' or fk.wdbh_h = '${wdbh}')
        </if>
        <if test="ryzt != null and ryzt != ''">
            and fk.zt = '${ryzt}'
        </if>
    </select>

    <!-- 此方法用于单独审讯预警 -->
    <select id="selectrygjBysxs" resultMap="BaseResultMap">
    select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
    WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, chas_yw_rygj.RYBH, BZ,rylx from chas_yw_rygj
    inner join (select rybh,max(kssj) maxsj from chas_yw_rygj where isdel=0
    and baqid='${baqid}' and qyid='${qyid}'
    and jssj is null group by rybh) tmp
    on chas_yw_rygj.rybh=tmp.rybh and chas_yw_rygj.kssj=tmp.maxsj;
  </select>
    <!-- 此方法用于单独审讯预警 查询从民警进入审讯室后，中途离开审讯室的定位-->
    <select id="selectrygjByMj" resultMap="BaseResultMap">
    select ID, ISDEL, DATA_FLAG, LRR_SFZH, LRSJ, XGR_SFZH, XGSJ, BAQID, BAQMC, RYID,
    WDBH, QYID, XM, KSSJ, JSSJ, FZRXM, HDNR, SBID, QYMC, RYBH, BZ,rylx from chas_yw_rygj
    where isdel = 0 and baqid='${baqid}' and qyid='${qyid}' and jssj &gt;='${startsj}' and jssj &lt;='${dqsj}'
        and rybh!='${rybh}' order by kssj desc

  </select>

    <select id="findcountByBaqid" resultType="java.lang.String">
        select count(*) from (
        select gj.rybh from chas_yw_rygj gj left join chas_xt_qy qy on gj.qyid = qy.id
        where qy.baqid = '${baqid}'  and qy.isdel = '0' and gj.isdel = '0' and qy.fjlx = '1'
        and qy.fjlx in ('1','10') and gj.rybh in(
            select rybh from gg_baqryxx where baqid = '${baqid}' and ryzt = '01' and isdel = '0'
        )
        group by gj.rybh ) tab
    </select>
</mapper>
